name: ğŸ“§ Envio Semanal de Editais - Segunda-feira 5h

on:
  schedule:
    - cron: '0 8 * * 1'    # TODA SEGUNDA-FEIRA Ã s 8:00 UTC (5:00 BRT)
  workflow_dispatch:        # Permite execuÃ§Ã£o manual

jobs:
  envio-semanal:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ”„ Checkout do cÃ³digo
        uses: actions/checkout@v4

      - name: ğŸ Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: ğŸ“¦ Instalar dependÃªncias
        run: |
          pip install selenium
          pip install beautifulsoup4
          pip install requests

      - name: ğŸŒ Instalar Google Chrome
        run: |
          wget -q -O - https://dl.google.com/linux/linux_signing_key.pub | sudo apt-key add -
          echo "deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main" | sudo tee /etc/apt/sources.list.d/google-chrome.list
          sudo apt-get update
          sudo apt-get install -y google-chrome-stable

      - name: ğŸ“§ Executar envio semanal
        run: |
          echo "ğŸš€ Iniciando envio semanal com timeout de 15 minutos..."
          timeout 900 python envio_semanal.py || echo "âŒ Processo semanal interrompido por timeout ou erro"
        env:
          EMAIL_USER: ${{ secrets.EMAIL_USER }}
          EMAIL_PASSWORD: ${{ secrets.EMAIL_PASSWORD }}

      - name: ğŸ’¾ Upload dos arquivos gerados
        uses: actions/upload-artifact@v4
        with:
          name: relatorios-semanais
          path: |
            editais_scraping.json
            editais_scraping.csv

      - name: ğŸ“Š Status do envio
        if: always()
        run: |
          echo "ğŸ“… Data: $(date)"
          echo "ğŸ“§ Workflow: Envio Semanal - Segunda-feira 5h"
          echo "ğŸ›ï¸ Sistema: Scrap Neuro - Multi-site"
          if [ -f "editais_scraping.json" ]; then
            echo "âœ… Arquivos gerados com sucesso"
            echo "ğŸ“Š Editais encontrados: $(grep -c '"titulo"' editais_scraping.json || echo 'N/A')"
          else
            echo "âŒ Falha na geraÃ§Ã£o dos arquivos"
          fi
